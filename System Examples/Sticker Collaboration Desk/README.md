# Sticker Collaboration Desk

Система для совместной работы над стикерами на доске.

## Функциональные требования
* Дать возможность любому пользователю создать новую доску с уникальными ссылкой
* Созданную доску можно править любому пользователю без ограничений
* Пользователи должны иметь возможность создавать/изменять/удалять стикеры на доске

## НеФункциональные требования
* Время жизни одной доски 1 неделя
* Пользователи должны видеть актуальное содержимое доски в режиме реального времени
* Оценка объёма требуемой памяти для хранения всех досок:
    * $7GB \simeq DeskSize * DeskCount * 7_{ДнейВНеделе}$, где:
      * $DeskSize \simeq 10KB$ - средний размер памяти необходимый для сохранения доски
      * $DeskCount \simeq 1.000.000$ - среднее количество новых досок, созданный в течении одного дня
* Оценка сверху пропускной способности системы в секунду:
    * $50MB \simeq Users * Diff$, где:
        * $Users \simeq 500.000$ - максимальное ожидаемое количество активных пользователей в секунду
        * $Diff \simeq DeskSize * 0.01 \simeq 0.1KB$ - diff-информации для доски, генерируемый пользователем в секунду
* Дополнительно:
    * Должна быть возможность работать offline, а также в ситуации с плохим соединением.


## Happy Path:
1. Пользователь создаёт новую доску, или подключается к уже созданной:
    Создание новой доски:
    ```txt
    [User's App] --(POST /api/desk/create_new? { "name": STRING })--> [Entry Point]  
        1. [Entry Point] --(запрос создания новой доски)--> [Desk Management Service]
        2. [Desk Management Service] --(запусти сессию коллаборации для созданной доски)--> [Collaboration Service]
        3. [Collaboration Service] --(запустить сессию коллаборации для созданной доски и отправить пользователю URL для подключения)--> [Entry Point]
    [Entry Point] --(200 {"collaboration_session": STRING})--> [User's App]
    ```
    Подключение к существующей доске:
    ```txt
    [User's App] --(POST /api/desk/connect_to? { "name": STRING })--> [Entry Point]  
        4. [Entry Point] --(запрос поиска доски)--> [Desk Management Service]
        5. [Desk Management Service] --(запусти сессию коллаборации для найденной доски)--> [Collaboration Service]
        6. [Collaboration Service] --(запустить сессию коллаборации для найденной доски и отправить пользователю URL для подключения)--> [Entry Point]
    [Entry Point] --(201 {"collaboration_session": STRING})--> [User's App]
    ```
2. Работает с доской внося изменения (возможно в режиме коллаборации с другими пользователями)
    ```txt
    [User's App] --(отправка diff для рабочей доски через WebSocket)--> [Collaboration Service]
    ```
3. Завершил работу над  доской  
    Пользователю ничего делать не надо, т.к. сессия коллаборации завершится автоматически по прошествии определённого времени в отсутствии новых изменений.
    ```txt
    [Collaboration Service] --(завершение сессии коллаборации + передача доски над которой завершена работа под дальнейшее управление)-->[Desk Management Service]
    [Desk Management Service] --(запрос на разрешение конфликтов, если если таковые есть)--> [Desk Collisions Service]
    [Desk Management Service] --(отправка доски на долгосрочное хранение)--> [Desk DB]
    ```

---

![](./stiсker%20collaboration%20desk.drawio.png)

---

# System Services
## Entry Point
Сервис внешнего доступа к Системе:
* **Load Balancer**:
    * управляет количеством запущенных экземпляров Collaboration Services в зависимости от количества активных сессий
* **API Gateway**

## Message Queue
Глобальная  очередь сообщений системы с возможностью отслеживания статуса сообщений с нотификацией отправителя.

## Business Logic Services:
### Collaboration Service (CS)
* управляет сессией (возможно несколькими) коллаборации:
    * инициации сессии
    * отслеживание и синхронизация изменений пользователей в процессе работы над доской
    * завершение сессии в случае разрыва всех WebSocket соединений с пользователями (либо по timeout в случае потери связи)

### Desk Collisions Service (DCS)
* разрешает коллизии, возникающие в процессе работы над доской или после

### Desk Management Service (DMS)
* управляет досками

## Data Base Services:
### Desk DB
* хранит доски
