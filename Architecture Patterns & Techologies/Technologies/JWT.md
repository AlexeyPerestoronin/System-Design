# JWT
**JWT (JSON Web Token)** — это:
- открытый стандарт (RFC 7519) для создания токенов доступа, который позволяет безопасно передавать информацию между сторонами в виде компактного JSON-объекта.
- цифровой пропуск, который содержит внутри себя информацию о пользователе и гарантирует, что она не была подделана.

Ключевые особенности JWT:
* Компактный: представлен в виде строки, которую легко передавать через HTTP-заголовки (обычно Authorization: Bearer <token>), URL-параметры или в теле запроса.
* Самодостаточный: внутри токена уже содержатся все необходимые данные о пользователе (например, ID, роль, права доступа), что позволяет серверу не хранить сессию в памяти или базе данных.
* Подписанный: токен имеет цифровую подпись (с использованием секретного ключа или пары публичный/приватный ключ), что гарантирует целостность данных (если токен подменить, сервер это сразу обнаружит).

## Из чего состоит JWT-токен
Токен выглядит как длинная строка, разделенная точками:  
`xxxxx.yyyyy.zzzzz`

Это три части в кодировке Base64Url:
1. **Header (Заголовок)**  
    Содержит метаинформацию о типе токена (typ: "JWT") и алгоритме подписи (alg: "HS256" или RS256).  
    Пример: `{"alg": "HS256", "typ": "JWT"}`
2. **Payload (Полезная нагрузка)**  
    Здесь хранятся фактические данные (утверждения — claims) о пользователе. Это может быть любая информация, например:  
        - sub (subject) — идентификатор пользователя  
        - name — имя  
        - role — роль (админ, пользователь)  
        - iat (issued at) — время создания токена  
        - exp (expiration time) — срок действия токена  
    Важно: Хотя данные кодируются, они не шифруются по умолчанию. Нельзя хранить в Payload секретные данные (пароли, номера карт).
3. **Signature (Подпись)**  
    Самая важная часть. Она создается путем шифрования закодированных Header и Payload при помощи секретного ключа (который знает только сервер) и алгоритма, указанного в Header.  
    Формула: `JWT = SRA256_ENCRYPT(SHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload)), secret_key))`  
    Подпись проверяет, что токен не был изменен после выдачи и что он был выдан доверенным сервером.  

## Как работает JWT на практике (типовая схема аутентификации):
1. **Вход:** → пользователь вводит логин/пароль и отправляет на сервер.
2. **Проверка** -→ сервер проверяет учетные данные.
3. **Создание токена** → если данные верны, сервер создает JWT, подписывает его своим секретным ключом и отправляет клиенту (например, в теле ответа):  
    1. Создание на сервере пары `(public_key, secret_key)` (например через RSA256)  
        `secret_key` - хранится только на сервере аутентификации
        `public_key` - может свободно распространяться между сервисами системы для проверки подлинности пользователя
    2. Создание на сервере токена для клиента: `JWT = SRA256_ENCRYPT(SHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload)), secret_key))`  
    3. Отправка созданного токена клиенту (обычно в теле ответа)
4. **Хранение** → клиент (браузер, мобильное приложение) сохраняет токен (часто в localStorage, sessionStorage или защищенных куки).  
5. **Доступ к защищенным ресурсам** → при каждом последующем запросе к API клиент добавляет токен в заголовок `Authorization: Bearer <ваш_jwt_токен>`.  
6. **Верификация** → сервер получает токен, проверяет его подпись, срок действия и данные из Payload, если все в порядке — возвращает запрошенные данные.  
    Проверка подписи на сервисе системы: `SHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload)) = SRA256_DECRYPT(JWT, public_key))`

<details>
<summary>Плюсы JWT ...</summary>

* **Stateless (Без состояния)**: серверу не нужно хранить сессию, т.к. он просто проверяет подпись и доверяет данным внутри токена.
* **Универсальность**: можно использовать в веб-приложениях, мобильных приложениях и микросервисных архитектурах.
* **Гибкость**: в Payload можно поместить любые данные, необходимые для работы приложения.
* **Безопасность**: надежная защита от подделки благодаря цифровой подписи.
</details>

<details>
<summary>Минусы и риски JWT ...</summary>

* **Невозможность отзыва до истечения срока**: токен валиден, пока не истечет его срок (exp). Чтобы "разлогинить" пользователя, нужны дополнительные механизмы (например, blacklist токенов).
* **Увеличенный размер**: JWT больше, чем случайный идентификатор сессии. При каждом запросе он передается по сети.
* **Хранение на клиенте**: если токен украдут (например, через XSS-атаку), злоумышленник сможет выдавать себя за пользователя. Поэтому критически важно защищать токен на клиенте и использовать HTTPS.
</details>

<details>
<summary>Где используется JWT ...</summary>

* Аутентификация и авторизация в RESTful API и SPA (Single Page Applications).
* Обмен информацией между микросервисами.
* Одноразовые ссылки (например, для сброса пароля).
</details>
